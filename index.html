<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SAS ‚Ä¢ CNH Social</title>
    <link
      rel="icon"
      href="https://statics.recife.pe.gov.br/images/dynamics/conecta/icons/favicon.png?w=32&h=32&fit=fill&border=2,transparent,shrink"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
      :root {
        --brand-primary: #0053a4;
        --brand-secondary: #003a73;
        --brand-highlight: #00a3ff;
        --surface: #f4f7fb;
        --surface-strong: #ffffff;
        --border-color: #d0d7e2;
        --text-strong: #1b263b;
        --text-muted: #5b6c8c;
      }

      *, *::before, *::after {
        box-sizing: border-box;
      }

      body {
        font-family: "Public Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--surface);
        color: var(--text-strong);
        min-height: 100vh;
      }

      header.site-header {
        background: url("https://statics.recife.pe.gov.br/images/dynamics/automacao/header.png?w=3000")
          center/cover no-repeat;
        color: #ffffff;
        padding: 3.5rem 0 2.75rem;
      }

      header .lead {
        color: rgba(255, 255, 255, 0.82);
        max-width: 100%;
        font-size: 1rem;
        line-height: 1.65;
        text-align: justify;
      }

      .badge-open {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.95rem;
        font-weight: 600;
        padding: 0.45rem 0.9rem;
        border-radius: 999px;
        background-color: rgba(255, 255, 255, 0.14);
      }

      .user-greeting {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.05rem;
        font-weight: 600;
        margin-bottom: 2rem;
        padding: 1rem 1.5rem;
        border-radius: 1rem;
        background: linear-gradient(135deg, rgba(0, 83, 164, 0.09), rgba(0, 163, 255, 0.12));
        color: var(--text-strong);
        box-shadow: 0 10px 30px rgba(0, 45, 98, 0.08);
      }

      .user-greeting::before {
        content: "üëã";
        font-size: 1.4rem;
      }

      .minhas-inscricoes-grid {
        margin-top: 1rem;
      }

      .minhas-inscricao-card {
        cursor: pointer;
        transition: transform 0.18s ease, box-shadow 0.18s ease;
        border: 1px solid rgba(0, 83, 164, 0.12);
        border-radius: 4px;
      }

      .minhas-inscricao-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(0, 45, 98, 0.12);
      }

      .minhas-inscricao-card.is-loading {
        pointer-events: none;
        opacity: 0.7;
      }

      .minhas-inscricoes-placeholder {
        padding: 1.25rem;
        border-radius: 4px;
        background: rgba(0, 83, 164, 0.05);
        border: 1px dashed rgba(0, 83, 164, 0.2);
        color: var(--text-muted);
      }

      .resumo-inscricao-list dt {
        font-size: 0.75rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: var(--text-muted);
      }

      .resumo-inscricao-list dd {
        font-weight: 600;
        color: var(--text-strong);
      }

      .resumo-inscricao-pre {
        white-space: pre-wrap;
        font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        font-size: 0.95rem;
        background: rgba(0, 83, 164, 0.08);
        color: var(--brand-secondary);
        padding: 1rem;
        border-radius: 0.75rem;
      }

      .publicacoes-panel,
      .updates-panel {
        border-radius: 4px;
      }

      .download-card strong {
        font-size: 1rem;
        color: var(--text-strong);
      }

      .download-card p {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.95rem;
        line-height: 1.4;
      }

      .download-card a {
        font-weight: 600;
      }

      .btn-submit[aria-disabled="true"] {
        cursor: not-allowed;
        opacity: 0.65;
        box-shadow: none;
      }

      .btn-submit[aria-disabled="true"]:focus-visible {
        box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.35);
      }

      input[readonly],
      select[aria-readonly="true"] {
        background-color: rgba(0, 83, 164, 0.08);
        cursor: not-allowed;
      }

      select[aria-readonly="true"] {
        pointer-events: none;
        user-select: none;
      }

      #publicacoes-list li + li {
        margin-top: 0.75rem;
      }

      .publicacoes-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .publicacoes-item-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
      }

      .publicacoes-item-icon {
        display: inline-block;
        width: 1.5rem;
        height: 1.5rem;
        flex-shrink: 0;
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
      }

      .publicacoes-item-icon--pdf {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23d32f2f' d='M6 2h7l5 5v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z'/%3E%3Cpath fill='%23ef5350' d='M13 2v5h5'/%3E%3Ctext x='12' y='17' text-anchor='middle' font-family='Arial, sans-serif' font-size='7' font-weight='700' fill='%23fff'%3EPDF%3C/text%3E%3C/svg%3E");
      }

      .publicacoes-item-icon--image {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Crect x='3' y='4' width='18' height='16' rx='2' fill='%23215695'/%3E%3Crect x='4.5' y='5.5' width='15' height='13' rx='1.2' fill='%233968c8'/%3E%3Ccircle cx='9' cy='11' r='2.2' fill='%23fff59d'/%3E%3Cpath fill='%23c5cae9' d='M6 18l4.2-4.6 2.7 3.2 2.6-3L18 18z'/%3E%3C/svg%3E");
      }

      .publicacoes-item-icon--generic {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%233f51b5' d='M7 2h7l5 5v15a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z'/%3E%3Cpath fill='%235c6bc0' d='M14 2v5h5'/%3E%3Crect x='8.5' y='12' width='7' height='1.5' rx='.75' fill='%23c5cae9'/%3E%3Crect x='8.5' y='15' width='5' height='1.5' rx='.75' fill='%23c5cae9'/%3E%3C/svg%3E");
      }

      .publicacoes-item time {
        flex-shrink: 0;
      }

      @media (min-width: 576px) {
        .publicacoes-item {
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
        }
      }

      @media (max-width: 575.98px) {
        .publicacoes-item-link {
          align-items: flex-start;
        }
      }

      .updates-panel {
        border-left: 3px solid var(--brand-highlight);
        padding-left: 1.2rem;
        color: var(--text-muted);
      }

      .updates-panel time {
        font-size: 0.85rem;
        color: var(--brand-secondary);
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      footer {
        color: var(--text-muted);
        padding: 2.5rem 0 2rem;
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        header.site-header {
          padding: 2.5rem 0 2rem;
        }

        .badge-open {
          width: 100%;
          justify-content: center;
        }

        .section-title {
          justify-content: flex-start;
        }
      }

      main {
        padding-bottom: 4rem;
      }

      .card-section {
        border: 1px solid var(--border-color);
        border-radius: 1rem;
        background: var(--surface-strong);
        box-shadow: 0 12px 30px rgba(24, 64, 120, 0.08);
      }

      .card-section + .card-section {
        margin-top: 1.5rem;
      }

      .section-header {
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.75rem;
        margin-bottom: 1.25rem;
      }

      .required::after {
        content: "*";
        color: #d32f2f;
        margin-left: 0.25rem;
      }

      .form-text {
        color: var(--text-muted);
      }

      .file-input-wrapper {
        border: 1px dashed var(--border-color);
        border-radius: 0.75rem;
        padding: 1rem;
        background: rgba(0, 83, 164, 0.03);
      }

      .file-input-wrapper label {
        font-weight: 600;
      }

      .file-name {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
      }

      .toast-container {
        z-index: 1080;
      }

      .legend-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        font-size: 0.85rem;
        color: var(--brand-secondary);
        background: rgba(0, 83, 164, 0.12);
        padding: 0.35rem 0.75rem;
        border-radius: 999px;
      }

      .tooltip-inner {
        text-align: left;
      }

      .btn-outline-primary:focus-visible,
      .form-control:focus,
      .form-select:focus,
      .form-check-input:focus {
        box-shadow: 0 0 0 0.25rem rgba(0, 83, 164, 0.25);
        border-color: var(--brand-highlight);
      }

      .border-dashed {
        border-style: dashed !important;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <div class="badge-open mb-3" role="status" aria-live="polite">
          <i class="bi bi-info-circle"></i>
          Inscri√ß√µes abertas ‚Äî CNH Social
        </div>
        <h1 class="display-5 fw-bold">CNH Social ‚Äì Secretaria de Assist√™ncia Social e Combate √† Fome</h1>
        <p class="lead mt-3">
          Programa municipal que oferta vagas gratuitas para obten√ß√£o ou adi√ß√£o de categorias da Carteira Nacional de Habilita√ß√£o
          (CNH) √†s pessoas em situa√ß√£o de vulnerabilidade social, com prioridade para fam√≠lias inscritas no Cad√önico e benefici√°rias
          de pol√≠ticas socioassistenciais no Recife.
        </p>
      </div>
    </header>
    <main class="py-5">
      <div class="container">
        <section class="mb-5">
          <div class="row g-4 align-items-start">
            <div class="col-12 col-lg-7">
              <div class="card card-section p-4 p-md-5">
                <div class="section-header d-flex align-items-center justify-content-between flex-wrap gap-2">
                  <h2 class="h4 mb-0">Como funciona</h2>
                  <span class="legend-badge"><i class="bi bi-calendar-event"></i> Edital vigente</span>
                </div>
                <ul class="list-unstyled mb-4 d-grid gap-3">
                  <li class="d-flex gap-3">
                    <i class="bi bi-patch-check-fill text-primary fs-5" aria-hidden="true"></i>
                    <div>
                      <strong>Vagas 100% gratuitas.</strong> Incluem aulas te√≥ricas, exames, 01 reteste gratuito e emiss√£o do documento
                      conforme cronograma do edital.
                    </div>
                  </li>
                  <li class="d-flex gap-3">
                    <i class="bi bi-people-fill text-primary fs-5" aria-hidden="true"></i>
                    <div>
                      <strong>P√∫blico priorit√°rio.</strong> Pessoas com renda familiar per capita de at√© meio sal√°rio m√≠nimo, inscritas no Cad√önico,
                      residentes no Recife h√° pelo menos 12 meses e com idade a partir de 18 anos na data da inscri√ß√£o.
                    </div>
                  </li>
                  <li class="d-flex gap-3">
                    <i class="bi bi-award-fill text-primary fs-5" aria-hidden="true"></i>
                    <div>
                      <strong>Cotas e pontua√ß√µes adicionais.</strong> Pontos extras para mulheres chefes de fam√≠lia, pessoas com defici√™ncia,
                      respons√°veis legais por pessoas com defici√™ncia/autismo, v√≠timas de viol√™ncia dom√©stica, acolhidos institucionalmente,
                      fam√≠lias com dependentes em tratamento continuado e autodeclarados pretos, pardos, ind√≠genas, trans/travestis ou quilombolas.
                    </div>
                  </li>
                  <li class="d-flex gap-3">
                    <i class="bi bi-flag-fill text-primary fs-5" aria-hidden="true"></i>
                    <div>
                      <strong>Compromissos.</strong> Frequ√™ncia m√≠nima de 75% em todas as etapas, entrega de documentos comprobat√≥rios quando solicitados
                      e respeito aos prazos de matr√≠cula definidos pelos Centros de Forma√ß√£o de Condutores (CFCs) parceiros.
                    </div>
                  </li>
                </ul>
                <div class="alert alert-info border-0" role="status">
                  <i class="bi bi-clock-history me-2" aria-hidden="true"></i>
                  Inscri√ß√µes at√© <strong>30/11/2025</strong>. Resultado preliminar divulgado no portal da Prefeitura e canais oficiais da Secretaria de Assist√™ncia Social e Combate √† Fome.
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-5">
              <div class="card card-section p-4 h-100">
                <h3 class="h5 mb-3">Checklist de elegibilidade</h3>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item bg-transparent px-0"><i class="bi bi-check-circle-fill text-success me-2"></i> Residir no Recife e comprovar v√≠nculo de, no m√≠nimo, 1 ano.</li>
                  <li class="list-group-item bg-transparent px-0"><i class="bi bi-check-circle-fill text-success me-2"></i> Estar inscrito(a) no Cad√önico atualizado (at√© 24 meses).</li>
                  <li class="list-group-item bg-transparent px-0"><i class="bi bi-check-circle-fill text-success me-2"></i> Ter renda familiar per capita at√© 1/2 sal√°rio m√≠nimo.</li>
                  <li class="list-group-item bg-transparent px-0"><i class="bi bi-check-circle-fill text-success me-2"></i> N√£o possuir CNH ativa (para 1¬™ habilita√ß√£o) ou possuir CNH v√°lida com mais de 30 dias (para adi√ß√£o).</li>
                  <li class="list-group-item bg-transparent px-0"><i class="bi bi-check-circle-fill text-success me-2"></i> N√£o ter sido benefici√°rio(a) do CNH Social nos √∫ltimos 5 anos.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <form id="cnhSocialForm" class="needs-validation" novalidate>
          <div class="card card-section p-4 p-md-5">
            <div class="section-header">
              <h2 class="h4 mb-0">Dados pessoais (pr√©-preenchidos)</h2>
            </div>
            <div class="row g-4">
              <div class="col-12 col-lg-6">
                <label for="nomeCompleto" class="form-label required">Nome completo</label>
                <input
                  type="text"
                  class="form-control"
                  id="nomeCompleto"
                  name="nomeCompleto"
                  placeholder="Nome cadastrado no Cad√önico"
                  value="{{ $json.data.nomeCompleto || '' }}"
                  readonly
                  aria-readonly="true"
                />
                <div class="form-text">Informa√ß√µes sincronizadas do Cad√önico/Conecta. Campo apenas para confer√™ncia.</div>
              </div>
              <div class="col-12 col-sm-6 col-lg-3">
                <label for="cpf" class="form-label required">CPF</label>
                <input
                  type="text"
                  class="form-control"
                  id="cpf"
                  name="cpf"
                  inputmode="numeric"
                  placeholder="000.000.000-00"
                  value="{{ $json.data.cpf || '' }}"
                  readonly
                  aria-readonly="true"
                />
              </div>
              <div class="col-12 col-sm-6 col-lg-3">
                <label for="nis" class="form-label required">NIS/PIS</label>
                <input
                  type="text"
                  class="form-control"
                  id="nis"
                  name="nis"
                  placeholder="N√∫mero do Cad√önico"
                  value="{{ $json.data.nis || '' }}"
                  readonly
                  aria-readonly="true"
                />
              </div>
              <div class="col-12 col-sm-6 col-lg-3">
                <label for="dataNascimento" class="form-label required">Data de nascimento</label>
                <input
                  type="date"
                  class="form-control"
                  id="dataNascimento"
                  name="dataNascimento"
                  value="{{ $json.data.dataNascimento || '' }}"
                  readonly
                  aria-readonly="true"
                />
              </div>
              <div class="col-12 col-sm-6 col-lg-3">
                <label for="genero" class="form-label required">Identifica√ß√£o de g√™nero</label>
                <select
                  class="form-select"
                  id="genero"
                  name="genero"
                  aria-describedby="generoHelp"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="feminino" {{ $json.data.genero === "feminino" ? "selected" : "" }}>Mulher</option>
                  <option value="masculino" {{ $json.data.genero === "masculino" ? "selected" : "" }}>Homem</option>
                  <option value="outro" {{ $json.data.genero === "outro" ? "selected" : "" }}>Outro / N√£o-bin√°rio</option>
                  <option value="nao_informar" {{ $json.data.genero === "nao_informar" ? "selected" : "" }}>Prefiro n√£o informar</option>
                </select>
                <small id="generoHelp" class="form-text">Usado apenas para regras de pontua√ß√£o previstas no edital.</small>
              </div>
              <div class="col-12 col-lg-9">
                <label for="nomeSocial" class="form-label">Nome social</label>
                <input
                  type="text"
                  class="form-control"
                  id="nomeSocial"
                  name="nomeSocial"
                  maxlength="120"
                  placeholder="Informe se desejar atendimento com nome social"
                  value="{{ $json.data.nomeSocial || '' }}"
                />
              </div>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header d-flex justify-content-between align-items-center flex-wrap gap-2">
              <h2 class="h4 mb-0">Endere√ßo</h2>
              <button class="btn btn-outline-primary btn-sm" type="button" id="btnAtualizarEndereco">
                <i class="bi bi-pencil-square me-1" aria-hidden="true"></i>Atualizar endere√ßo
              </button>
            </div>
            <div class="alert alert-light border-dashed" role="note">
              Confirme os dados residenciais. Caso tenha mudado, clique em "Atualizar endere√ßo" e informe o novo endere√ßo. Um comprovante recente poder√° ser solicitado.
            </div>
            <div class="row g-4">
              <div class="col-12 col-sm-4">
                <label for="cep" class="form-label required">CEP</label>
                <input
                  type="text"
                  class="form-control"
                  id="cep"
                  name="cep"
                  inputmode="numeric"
                  placeholder="00000-000"
                  value="{{ $json.data.cep || '' }}"
                  readonly
                  aria-describedby="cepStatus"
                />
                <div id="cepStatus" class="form-text" aria-live="polite"></div>
              </div>
              <div class="col-12 col-sm-8">
                <label for="logradouro" class="form-label required">Logradouro</label>
                <input
                  type="text"
                  class="form-control"
                  id="logradouro"
                  name="logradouro"
                  placeholder="Rua, avenida, travessa"
                  value="{{ $json.data.logradouro || '' }}"
                  readonly
                />
              </div>
              <div class="col-12 col-sm-4 col-lg-2">
                <label for="numero" class="form-label required">N√∫mero</label>
                <input
                  type="text"
                  class="form-control"
                  id="numero"
                  name="numero"
                  placeholder="S/N"
                  value="{{ $json.data.numero || '' }}"
                  readonly
                  inputmode="text"
                  pattern="^(?:[0-9]+|S/N)$"
                  title="Informe apenas n√∫meros ou S/N"
                />
              </div>
              <div class="col-12 col-sm-8 col-lg-4">
                <label for="complemento" class="form-label">Complemento</label>
                <input
                  type="text"
                  class="form-control"
                  id="complemento"
                  name="complemento"
                  placeholder="Apartamento, bloco"
                  value="{{ $json.data.complemento || '' }}"
                  readonly
                />
              </div>
              <div class="col-12 col-md-4">
                <label for="bairro" class="form-label required">Bairro</label>
                <input
                  type="text"
                  class="form-control"
                  id="bairro"
                  name="bairro"
                  value="{{ $json.data.bairro || '' }}"
                  readonly
                />
              </div>
              <div class="col-12 col-md-5">
                <label for="cidade" class="form-label required">Munic√≠pio</label>
                <input
                  type="text"
                  class="form-control"
                  id="cidade"
                  name="cidade"
                  value="{{ $json.data.cidade || 'Recife' }}"
                  readonly
                />
              </div>
              <div class="col-12 col-md-3">
                <label for="uf" class="form-label required">UF</label>
                <select class="form-select" id="uf" name="uf" disabled>
                  <option value="PE" {{ $json.data.uf === "PE" ? "selected" : "" }}>PE</option>
                </select>
              </div>
              <div class="col-12">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="enderecoAtualizado"
                    name="enderecoAtualizado"
                    {{ $json.data.enderecoAtualizado === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="enderecoAtualizado">Meu endere√ßo informado acima est√° diferente do Cad√önico</label>
                </div>
                <small class="form-text">Se marcado, ser√° obrigat√≥rio anexar comprovante atualizado (at√© 90 dias).</small>
              </div>
              <div class="col-12 col-lg-6 d-none" id="docResidenciaWrapper">
                <div class="file-input-wrapper">
                  <label for="docResidencia" class="form-label" id="docResidenciaLabel">Comprovante de resid√™ncia recente (PDF/JPG/PNG at√© 5 MB)</label>
                  <input class="form-control" type="file" id="docResidencia" name="docResidencia" accept=".pdf,.jpg,.jpeg,.png" aria-describedby="docResidenciaHelp" />
                  <div id="docResidenciaHelp" class="form-text">Envie conta de consumo ou declara√ß√£o emitida h√° at√© 90 dias.</div>
                  <div class="file-name" id="docResidenciaName"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header">
              <h2 class="h4 mb-0">Contatos</h2>
            </div>
            <div class="row g-4">
              <div class="col-12 col-md-6">
                <label for="telefone" class="form-label required">Telefone/WhatsApp</label>
                <input
                  type="text"
                  class="form-control"
                  id="telefone"
                  name="telefone"
                  inputmode="tel"
                  placeholder="(81) 90000-0000"
                  value="{{ $json.data.telefone || '' }}"
                  data-required-field="true"
                  required
                />
                <div class="form-text">Informe um n√∫mero ativo para contato e envio de protocolo.</div>
              </div>
              <div class="col-12 col-md-6">
                <label for="email" class="form-label required">E-mail</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  placeholder="nome@exemplo.com"
                  value="{{ $json.data.email || '' }}"
                  data-required-field="true"
                  required
                />
              </div>
              <div class="col-12 col-md-6">
                <label for="emailConfirm" class="form-label required">Confirme o e-mail</label>
                <input
                  type="email"
                  class="form-control"
                  id="emailConfirm"
                  name="emailConfirm"
                  placeholder="Repita seu e-mail"
                  aria-describedby="emailConfirmHelp"
                  value="{{ $json.data.email || '' }}"
                  data-required-field="true"
                  required
                />
                <div id="emailConfirmHelp" class="form-text">O endere√ßo deve ser id√™ntico ao campo anterior.</div>
              </div>
              <div class="col-12">
                <label for="preferenciaContato" class="form-label required">Canal de contato preferencial</label>
                <select
                  class="form-select"
                  id="preferenciaContato"
                  name="preferenciaContato"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="whatsapp" {{ $json.data.preferenciaContato === "whatsapp" ? "selected" : "" }}>WhatsApp</option>
                  <option value="email" {{ $json.data.preferenciaContato === "email" ? "selected" : "" }}>E-mail</option>
                  <option value="ligacao" {{ $json.data.preferenciaContato === "ligacao" ? "selected" : "" }}>Liga√ß√£o telef√¥nica</option>
                </select>
              </div>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header">
              <h2 class="h4 mb-0">Crit√©rios socioassistenciais</h2>
            </div>
            <div class="row g-4">
              <div class="col-12 col-md-6">
                <label for="situacaoTrabalho" class="form-label required">Situa√ß√£o de trabalho atual</label>
                <select
                  class="form-select"
                  id="situacaoTrabalho"
                  name="situacaoTrabalho"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="emprego_formal" {{ $json.data.situacaoTrabalho === "emprego_formal" ? "selected" : "" }}>Emprego formal</option>
                  <option value="trabalho_informal" {{ $json.data.situacaoTrabalho === "trabalho_informal" ? "selected" : "" }}>Trabalho informal</option>
                  <option value="desempregado" {{ $json.data.situacaoTrabalho === "desempregado" ? "selected" : "" }}>Desempregado(a)</option>
                  <option value="aplicativo" {{ $json.data.situacaoTrabalho === "aplicativo" ? "selected" : "" }}>Trabalhador(a) de aplicativo</option>
                </select>
              </div>
              <div class="col-12 col-md-6 d-none" id="grupoMulherChefe">
                <div class="form-check pt-4">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="mulherChefe"
                    name="mulherChefe"
                    {{ $json.data.mulherChefe === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="mulherChefe">Sou mulher e respons√°vel pela renda familiar (chefe de fam√≠lia)</label>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="acolhimento"
                    name="acolhimento"
                    {{ $json.data.acolhimento === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="acolhimento">Resido em servi√ßo de acolhimento institucional</label>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="dependenteTratamento"
                    name="dependenteTratamento"
                    {{ $json.data.dependenteTratamento === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="dependenteTratamento">Possuo dependente em tratamento terap√™utico cont√≠nuo</label>
                </div>
              </div>
              <div class="col-12">
                <label for="rendaFamiliar" class="form-label required">Renda familiar mensal (R$)</label>
                <input
                  type="number"
                  class="form-control"
                  id="rendaFamiliar"
                  name="rendaFamiliar"
                  min="0"
                  step="0.01"
                  placeholder="Informe o valor total da renda familiar"
                  value="{{ $json.data.rendaFamiliar || '' }}"
                  aria-describedby="rendaHelp"
                  data-required-field="true"
                  required
                />
                <small id="rendaHelp" class="form-text">Ser√° comparada com o n√∫mero de integrantes registrado no Cad√önico para verifica√ß√£o do crit√©rio de renda per capita.</small>
              </div>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header">
              <h2 class="h4 mb-0">Crit√©rios de prioriza√ß√£o e diversidade</h2>
            </div>
            <div class="row g-4">
              <div class="col-12 col-md-6">
                <label for="racaCor" class="form-label required">Autodeclara√ß√£o de cor/ra√ßa</label>
                <select
                  class="form-select"
                  id="racaCor"
                  name="racaCor"
                  aria-describedby="racaCorHelp"
                  aria-readonly="true"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="branca" {{ $json.data.racaCor === "branca" ? "selected" : "" }}>Branca</option>
                  <option value="preta" {{ $json.data.racaCor === "preta" ? "selected" : "" }}>Preta</option>
                  <option value="parda" {{ $json.data.racaCor === "parda" ? "selected" : "" }}>Parda</option>
                  <option value="amarela" {{ $json.data.racaCor === "amarela" ? "selected" : "" }}>Amarela</option>
                  <option value="indigena" {{ $json.data.racaCor === "indigena" ? "selected" : "" }}>Ind√≠gena</option>
                  <option value="nao_informar" {{ $json.data.racaCor === "nao_informar" ? "selected" : "" }}>Prefiro n√£o informar</option>
                </select>
                <small id="racaCorHelp" class="form-text">
                  Informa√ß√£o carregada a partir do Cad√önico para ranqueamento e pol√≠ticas afirmativas conforme edital.
                </small>
              </div>
              <fieldset class="col-12 col-md-6">
                <legend class="form-label mb-1">Identidade e grupos priorit√°rios</legend>
                <div class="form-text">Marque se voc√™ se enquadra nas cotas adicionais previstas.</div>
                <div class="form-check mt-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="pessoaPretaParda"
                    name="pessoaPretaParda"
                    {{ $json.data.pessoaPretaParda === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="pessoaPretaParda">Sou pessoa preta ou parda</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="pessoaIndigena"
                    name="pessoaIndigena"
                    {{ $json.data.pessoaIndigena === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="pessoaIndigena">Sou pessoa ind√≠gena</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="pessoaTrans"
                    name="pessoaTrans"
                    {{ $json.data.pessoaTrans === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="pessoaTrans">Sou pessoa trans, travesti ou n√£o-bin√°ria</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="egressoSocioeducativo"
                    name="egressoSocioeducativo"
                    {{ $json.data.egressoSocioeducativo === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="egressoSocioeducativo">Sou egresso(a) do sistema socioeducativo</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="pessoaQuilombola"
                    name="pessoaQuilombola"
                    {{ $json.data.pessoaQuilombola === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="pessoaQuilombola">Sou quilombola ou perten√ßo a povos e comunidades tradicionais</label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="sim"
                    id="pessoaRua"
                    name="pessoaRua"
                    {{ $json.data.pessoaRua === "sim" ? "checked" : "" }}
                  />
                  <label class="form-check-label" for="pessoaRua">Vivo em situa√ß√£o de rua ou em unidade de acolhimento</label>
                </div>
              </fieldset>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header d-flex align-items-center justify-content-between flex-wrap gap-2">
              <h2 class="h4 mb-0">Grupos e condi√ß√µes especiais</h2>
              <span class="legend-badge"><i class="bi bi-paperclip"></i> Anexe os comprovantes solicitados</span>
            </div>
            <div class="row g-4">
              <div class="col-12 col-md-6">
                <label class="form-label required" for="pcd">Pessoa com defici√™ncia (PCD)</label>
                <select
                  class="form-select"
                  id="pcd"
                  name="pcd"
                  aria-describedby="pcdHelp"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="sim" {{ $json.data.pcd === "sim" ? "selected" : "" }}>Sim</option>
                  <option value="nao" {{ $json.data.pcd === "nao" ? "selected" : "" }}>N√£o</option>
                </select>
                <small id="pcdHelp" class="form-text">Em caso afirmativo, apresente laudo m√©dico conforme modelos do SUS.</small>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label required" for="maeAtipica">Sou m√£e/pai at√≠pico (respons√°vel legal por pessoa PCD/TEA)</label>
                <select
                  class="form-select"
                  id="maeAtipica"
                  name="maeAtipica"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="sim" {{ $json.data.maeAtipica === "sim" ? "selected" : "" }}>Sim</option>
                  <option value="nao" {{ $json.data.maeAtipica === "nao" ? "selected" : "" }}>N√£o</option>
                </select>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label required" for="vitimaViolencia">V√≠tima de viol√™ncia dom√©stica</label>
                <select
                  class="form-select"
                  id="vitimaViolencia"
                  name="vitimaViolencia"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="sim" {{ $json.data.vitimaViolencia === "sim" ? "selected" : "" }}>Sim</option>
                  <option value="nao" {{ $json.data.vitimaViolencia === "nao" ? "selected" : "" }}>N√£o</option>
                </select>
                <small class="form-text">A identidade das candidatas ser√° preservada conforme edital.</small>
              </div>
              <div class="col-12">
                <label for="necessidadesEspeciais" class="form-label">Informa√ß√µes complementares</label>
                <textarea
                  class="form-control"
                  id="necessidadesEspeciais"
                  name="necessidadesEspeciais"
                  rows="3"
                  maxlength="500"
                  placeholder="Descreva necessidades espec√≠ficas de atendimento, adapta√ß√µes ou informa√ß√µes relevantes"
                >{{ $json.data.necessidadesEspeciais || '' }}</textarea>
              </div>
              <div class="col-12 col-lg-6 d-none" id="laudoPcdWrapper">
                <div class="file-input-wrapper">
                  <label for="laudoPcd" class="form-label required">Laudo m√©dico PCD (PDF, JPG ou PNG at√© 5 MB)</label>
                  <input class="form-control" type="file" id="laudoPcd" name="laudoPcd" accept=".pdf,.jpg,.jpeg,.png" aria-describedby="laudoPcdInfo" />
                  <div id="laudoPcdInfo" class="form-text">Documento emitido por servi√ßo p√∫blico ou conveniado (validade 12 meses).</div>
                  <div class="file-name" id="laudoPcdName"></div>
                </div>
              </div>
              <div class="col-12 col-lg-6 d-none" id="docResponsavelWrapper">
                <div class="file-input-wrapper">
                  <label for="docResponsavel" class="form-label required">Comprovante de responsabilidade legal (PDF/JPG/PNG at√© 5 MB)</label>
                  <input class="form-control" type="file" id="docResponsavel" name="docResponsavel" accept=".pdf,.jpg,.jpeg,.png" />
                  <div class="file-name" id="docResponsavelName"></div>
                </div>
              </div>
              <div class="col-12 col-lg-6 d-none" id="docViolenciaWrapper">
                <div class="file-input-wrapper">
                  <label for="docViolencia" class="form-label">Documento comprobat√≥rio ou declara√ß√£o (PDF/JPG/PNG at√© 5 MB)</label>
                  <input class="form-control" type="file" id="docViolencia" name="docViolencia" accept=".pdf,.jpg,.jpeg,.png" />
                  <div class="file-name" id="docViolenciaName"></div>
                  <small class="form-text">Caso n√£o possua boletim ou medida protetiva, envie declara√ß√£o simples assinada.</small>
                </div>
              </div>
              <div class="col-12 col-lg-6 d-none" id="docAcolhimentoWrapper">
                <div class="file-input-wrapper">
                  <label for="docAcolhimento" class="form-label required">Declara√ß√£o da unidade de acolhimento (PDF/JPG/PNG at√© 5 MB)</label>
                  <input class="form-control" type="file" id="docAcolhimento" name="docAcolhimento" accept=".pdf,.jpg,.jpeg,.png" />
                  <div class="file-name" id="docAcolhimentoName"></div>
                </div>
              </div>
              <div class="col-12 col-lg-6 d-none" id="docDependenteWrapper">
                <div class="file-input-wrapper">
                  <label for="docDependente" class="form-label required">Comprovante de tratamento terap√™utico cont√≠nuo (PDF/JPG/PNG at√© 5 MB)</label>
                  <input class="form-control" type="file" id="docDependente" name="docDependente" accept=".pdf,.jpg,.jpeg,.png" />
                  <div class="file-name" id="docDependenteName"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header">
              <h2 class="h4 mb-0">Categoria de habilita√ß√£o</h2>
            </div>
            <div class="row g-4">
              <div class="col-12 col-md-6">
                <label for="categoria" class="form-label required">Categoria desejada</label>
                <select
                  class="form-select"
                  id="categoria"
                  name="categoria"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="a_primeira">Categoria A (1¬™ habilita√ß√£o)</option>
                  <option value="b_primeira">Categoria B (1¬™ habilita√ß√£o)</option>
                  <option value="adicao_a">Adi√ß√£o de categoria A</option>
                  <option value="adicao_b">Adi√ß√£o de categoria B</option>
                </select>
              </div>
              <div class="col-12 col-md-6">
                <label for="turno" class="form-label required">Turno preferencial</label>
                <select
                  class="form-select"
                  id="turno"
                  name="turno"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="manha">Manh√£</option>
                  <option value="tarde">Tarde</option>
                  <option value="noite">Noite</option>
                  <option value="indiferente">Indiferente</option>
                </select>
              </div>
              <div class="col-12">
                <label for="polo" class="form-label required">Polo/CFC de prefer√™ncia</label>
                <select
                  class="form-select"
                  id="polo"
                  name="polo"
                  data-required-field="true"
                  required
                >
                  <option value="">Selecione</option>
                  <option value="cfc_santo_amaro">CFC Santo Amaro ‚Äì Bairro Santo Amaro</option>
                  <option value="cfc_ibura">CFC Ibura ‚Äì Ibura</option>
                  <option value="cfc_casa_amarela">CFC Casa Amarela ‚Äì Casa Amarela</option>
                  <option value="cfc_pina">CFC Pina ‚Äì Pina</option>
                  <option value="cfc_varzea">CFC V√°rzea ‚Äì V√°rzea</option>
                </select>
              </div>
              <div class="col-12 col-md-6 d-none" id="cnhNumeroWrapper">
                <label for="numeroCnh" class="form-label required">N√∫mero da CNH (para adi√ß√£o)</label>
                <input type="text" class="form-control" id="numeroCnh" name="numeroCnh" inputmode="numeric" placeholder="Informe conforme CNH" />
              </div>
              <div class="col-12 col-md-6 d-none" id="cnhValidadeWrapper">
                <label for="validadeCnh" class="form-label required">Validade da CNH</label>
                <input type="date" class="form-control" id="validadeCnh" name="validadeCnh" aria-describedby="validadeHelp" />
                <small id="validadeHelp" class="form-text">A CNH precisa ter validade superior a 30 dias na data de inscri√ß√£o.</small>
              </div>
              <div class="col-12 col-lg-6 d-none" id="cnhArquivoWrapper">
                <div class="file-input-wrapper">
                  <label for="cnhArquivo" class="form-label required">CNH (frente e verso) ‚Äì PDF/JPG/PNG at√© 5 MB</label>
                  <input class="form-control" type="file" id="cnhArquivo" name="cnhArquivo" accept=".pdf,.jpg,.jpeg,.png" />
                  <div class="file-name" id="cnhArquivoName"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header">
              <h2 class="h4 mb-0">Documentos complementares</h2>
            </div>
            <div class="row g-4">
              <div class="col-12 col-lg-6">
                <div class="file-input-wrapper">
                  <label for="docIdentidade" class="form-label required">Documento oficial com foto (RG ou passaporte) ‚Äì PDF/JPG/PNG at√© 5 MB</label>
                  <input
                    class="form-control"
                    type="file"
                    id="docIdentidade"
                    name="docIdentidade"
                    accept=".pdf,.jpg,.jpeg,.png"
                    data-required-field="true"
                    required
                  />
                  <div class="file-name" id="docIdentidadeName"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card card-section p-4 p-md-5">
            <div class="section-header">
              <h2 class="h4 mb-0">Declara√ß√µes e consentimentos</h2>
            </div>
            <div class="d-grid gap-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="sim"
                  id="lgpd"
                  name="lgpd"
                  required
                  data-required-field="true"
                />
                <label class="form-check-label" for="lgpd">
                  Li e autorizo o tratamento dos meus dados pessoais para execu√ß√£o do Programa CNH Social, conforme a Lei Geral de Prote√ß√£o de Dados.
                </label>
                <a href="#" class="d-block small mt-1">Consultar pol√≠tica de privacidade</a>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="sim"
                  id="veracidade"
                  name="veracidade"
                  required
                  data-required-field="true"
                />
                <label class="form-check-label" for="veracidade">
                  Declaro verdadeiras todas as informa√ß√µes prestadas e estou ciente de que a falsidade implicar√° desclassifica√ß√£o e san√ß√µes legais.
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="sim" id="imagem" name="imagem" />
                <label class="form-check-label" for="imagem">Autorizo o uso da minha imagem para divulga√ß√£o institucional do programa.</label>
              </div>
              <div class="form-text">Ap√≥s o envio, o protocolo ser√° encaminhado para seu e-mail e WhatsApp cadastrados.</div>
            </div>
            <div class="mt-4 d-flex flex-column flex-md-row gap-3">
              <button
                type="button"
                class="btn btn-primary btn-lg px-4 btn-submit"
                id="submitButton"
                aria-disabled="true"
                data-ready="false"
              >
                <i class="bi bi-send-fill me-2" aria-hidden="true"></i>Enviar inscri√ß√£o
              </button>
              <button type="reset" class="btn btn-outline-secondary btn-lg px-4">
                Limpar campos edit√°veis
              </button>
            </div>
          </div>
        </form>
      </div>
    </main>

    <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true" data-bs-focus="false">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fw-bold d-flex align-items-center gap-2" id="feedbackModalHeader">
              <span id="feedbackModalEmoji" aria-hidden="true">‚ö†Ô∏è</span>
              <span id="feedbackModalLabel">Alerta</span>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
          </div>
          <div class="modal-body">
            <p id="feedbackModalMessage" class="mb-3">Por favor, preencha os campos obrigat√≥rios destacados.</p>
            <ul id="feedbackModalList" class="list-unstyled mb-0"></ul>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/imask@7.6.0/dist/imask.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/just-validate@4.6.0/dist/just-validate.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <script>
      const sanitizePrefillObject = (values) => {
        if (!values || typeof values !== "object") {
          return {};
        }
        const sanitized = {};
        Object.entries(values).forEach(([key, value]) => {
          if (value == null) {
            sanitized[key] = "";
            return;
          }
          if (typeof value === "string") {
            let trimmed = value.trim();
            if (!trimmed || trimmed.startsWith("{{")) {
              sanitized[key] = "";
              return;
            }
            if (
              (trimmed.startsWith('"') && trimmed.endsWith('"')) ||
              (trimmed.startsWith("'") && trimmed.endsWith("'"))
            ) {
              trimmed = trimmed.slice(1, -1);
            }
            trimmed = trimmed.replace(/\\"/g, '"').replace(/\\n/g, "\n");
            if (trimmed === "null" || trimmed === "undefined") {
              trimmed = "";
            }
            sanitized[key] = trimmed;
            return;
          }
          sanitized[key] = value;
        });
        return sanitized;
      };

      const hasPrefillContent = (values) => {
        if (!values || typeof values !== "object") {
          return false;
        }
        return Object.values(values).some((value) => {
          if (value == null) return false;
          if (typeof value === "string") return value.trim() !== "";
          return true;
        });
      };

      const rawPrefillValues = {
        nomeCompleto: `{{ $json.data.nomeCompleto || '' }}`,
        cpf: `{{ $json.data.cpf || '' }}`,
        nis: `{{ $json.data.nis || '' }}`,
        dataNascimento: `{{ $json.data.dataNascimento || '' }}`,
        genero: `{{ $json.data.genero || '' }}`,
        nomeSocial: `{{ $json.data.nomeSocial || '' }}`,
        cep: `{{ $json.data.cep || '' }}`,
        logradouro: `{{ $json.data.logradouro || '' }}`,
        numero: `{{ $json.data.numero || '' }}`,
        complemento: `{{ $json.data.complemento || '' }}`,
        bairro: `{{ $json.data.bairro || '' }}`,
        cidade: `{{ $json.data.cidade || '' }}`,
        uf: `{{ $json.data.uf || '' }}`,
        enderecoAtualizado: `{{ $json.data.enderecoAtualizado || '' }}`,
        telefone: `{{ $json.data.telefone || '' }}`,
        email: `{{ $json.data.email || '' }}`,
        preferenciaContato: `{{ $json.data.preferenciaContato || '' }}`,
        situacaoTrabalho: `{{ $json.data.situacaoTrabalho || '' }}`,
        mulherChefe: `{{ $json.data.mulherChefe || '' }}`,
        acolhimento: `{{ $json.data.acolhimento || '' }}`,
        dependenteTratamento: `{{ $json.data.dependenteTratamento || '' }}`,
        rendaFamiliar: `{{ $json.data.rendaFamiliar || '' }}`,
        racaCor: `{{ $json.data.racaCor || '' }}`,
        pessoaPretaParda: `{{ $json.data.pessoaPretaParda || '' }}`,
        pessoaIndigena: `{{ $json.data.pessoaIndigena || '' }}`,
        pessoaTrans: `{{ $json.data.pessoaTrans || '' }}`,
        egressoSocioeducativo: `{{ $json.data.egressoSocioeducativo || '' }}`,
        pessoaQuilombola: `{{ $json.data.pessoaQuilombola || '' }}`,
        pessoaRua: `{{ $json.data.pessoaRua || '' }}`,
        pcd: `{{ $json.data.pcd || '' }}`,
        maeAtipica: `{{ $json.data.maeAtipica || '' }}`,
        vitimaViolencia: `{{ $json.data.vitimaViolencia || '' }}`,
        necessidadesEspeciais: `{{ $json.data.necessidadesEspeciais || '' }}`,
      };

      let prefillValues = sanitizePrefillObject(rawPrefillValues);
      if (!hasPrefillContent(prefillValues)) {
        prefillValues = {};
      }

      if (!hasPrefillContent(prefillValues)) {
        const fallbackSources = [
          window.prefillPayload,
          window.initialPrefillPayload,
          window.initialPayload,
          window.prefillValues,
        ];
        for (const source of fallbackSources) {
          if (!source) continue;
          let candidate = source;
          if (typeof candidate === "string") {
            try {
              candidate = JSON.parse(candidate);
            } catch (error) {
              candidate = null;
            }
          }
          if (Array.isArray(candidate) && candidate.length) {
            const firstItem = candidate[0];
            candidate =
              firstItem && typeof firstItem === "object"
                ? firstItem.data && typeof firstItem.data === "object"
                  ? firstItem.data
                  : firstItem
                : null;
          }
          const sanitizedCandidate = sanitizePrefillObject(candidate);
          if (hasPrefillContent(sanitizedCandidate)) {
            prefillValues = sanitizedCandidate;
            break;
          }
        }
      }
      const editableFields = ["cep", "logradouro", "numero", "complemento", "bairro", "cidade"];
      const cepInput = document.getElementById("cep");
      const numeroInput = document.getElementById("numero");
      const logradouroInput = document.getElementById("logradouro");
      const complementoInput = document.getElementById("complemento");
      const bairroInput = document.getElementById("bairro");
      const cidadeInput = document.getElementById("cidade");
      const ufSelect = document.getElementById("uf");
      const cepStatus = document.getElementById("cepStatus");
      const btnAtualizarEndereco = document.getElementById("btnAtualizarEndereco");
      let enderecoEdicaoAtiva = false;

      const maskCpf = IMask(document.getElementById("cpf"), { mask: "000.000.000-00" });
      const maskCep = IMask(cepInput, { mask: "00000-000" });
      const maskTelefone = IMask(document.getElementById("telefone"), {
        mask: "(00) 00000-0000",
      });

      if (numeroInput) {
        numeroInput.addEventListener("input", () => {
          if (numeroInput.readOnly) return;
          let value = numeroInput.value.toUpperCase();
          if (value.startsWith("S")) {
            const length = Math.min(value.length, 3);
            value = "S/N".slice(0, length === 0 ? 0 : Math.max(length, 1));
          } else {
            value = value.replace(/[^0-9]/g, "");
          }
          numeroInput.value = value;
        });

        numeroInput.addEventListener("blur", () => {
          if (numeroInput.readOnly) return;
          if (/^S($|\/)$/.test(numeroInput.value)) {
            numeroInput.value = "S/N";
          }
        });
      }

      const generoSelect = document.getElementById("genero");
      const grupoMulherChefe = document.getElementById("grupoMulherChefe");
      generoSelect.addEventListener("change", () => {
        if (generoSelect.value === "feminino") {
          grupoMulherChefe.classList.remove("d-none");
        } else {
          grupoMulherChefe.classList.add("d-none");
          document.getElementById("mulherChefe").checked = false;
        }
      });

      const racaCorSelect = document.getElementById("racaCor");
      if (racaCorSelect) {
        const blockSelectInteraction = (event) => {
          if (event.type === "keydown") {
            if (event.key === "Tab" || event.key === "Shift") {
              return;
            }
          }
          event.preventDefault();
        };
        racaCorSelect.addEventListener("mousedown", blockSelectInteraction);
        racaCorSelect.addEventListener("keydown", blockSelectInteraction);
        racaCorSelect.addEventListener("change", () => {
          if (racaCorSelect.dataset.lockedValue) {
            racaCorSelect.value = racaCorSelect.dataset.lockedValue;
          }
        });
      }

      const atualizarStatusCep = (mensagem, classe) => {
        if (!cepStatus) return;
        cepStatus.classList.remove("text-danger", "text-success", "text-muted");
        if (classe) {
          cepStatus.classList.add(classe);
        }
        cepStatus.textContent = mensagem;
      };

      const preencherEndereco = (dados) => {
        if (dados.street || dados.logradouro) logradouroInput.value = dados.street || dados.logradouro;
        if (dados.neighborhood || dados.bairro) bairroInput.value = dados.neighborhood || dados.bairro;
        if (dados.city || dados.localidade) cidadeInput.value = dados.city || dados.localidade;
        if (dados.complement || dados.complemento) complementoInput.value = dados.complement || dados.complemento;
        if (dados.state && ufSelect) {
          const possuiOpcao = Array.from(ufSelect.options).some((option) => option.value === dados.state);
          if (!possuiOpcao) {
            const novaOpcao = document.createElement("option");
            novaOpcao.value = dados.state;
            novaOpcao.textContent = dados.state;
            ufSelect.appendChild(novaOpcao);
          }
          ufSelect.value = dados.state;
        }
      };

      const consultarCepBrasilApi = async (cepLimpo) => {
        if (!cepLimpo || cepLimpo.length !== 8) return;
        atualizarStatusCep("Consultando CEP na BrasilAPI...", "text-muted");
        try {
          const resposta = await fetch(`https://brasilapi.com.br/api/cep/v2/${cepLimpo}`);
          if (!resposta.ok) {
            throw new Error("CEP n√£o encontrado");
          }
          const endereco = await resposta.json();
          preencherEndereco(endereco);
          atualizarStatusCep("Endere√ßo localizado automaticamente.", "text-success");
        } catch (erro) {
          atualizarStatusCep("N√£o foi poss√≠vel localizar o CEP. Preencha os campos manualmente.", "text-danger");
          if (logradouroInput) {
            logradouroInput.focus();
          }
        }
      };

      btnAtualizarEndereco.addEventListener("click", () => {
        editableFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          field.readOnly = false;
          field.removeAttribute("aria-readonly");
        });
        ufSelect.disabled = false;
        enderecoEdicaoAtiva = true;
        btnAtualizarEndereco.setAttribute("aria-pressed", "true");
        atualizarStatusCep("Informe o CEP e aguarde o preenchimento autom√°tico.", "text-muted");
        cepInput.focus();
        updateSubmitState();
      });

      maskCep.on("accept", () => {
        if (!enderecoEdicaoAtiva) return;
        if (maskCep.unmaskedValue.length < 8) {
          atualizarStatusCep("Digite o CEP completo para buscar automaticamente.", "text-muted");
        }
      });

      maskCep.on("complete", () => {
        if (!enderecoEdicaoAtiva) return;
        consultarCepBrasilApi(maskCep.unmaskedValue);
      });

      const toggleFileSection = (condition, wrapperId) => {
        const wrapper = document.getElementById(wrapperId);
        if (!wrapper) return;
        if (condition) {
          wrapper.classList.remove("d-none");
        } else {
          wrapper.classList.add("d-none");
          const inputs = wrapper.querySelectorAll("input, select, textarea");
          inputs.forEach((input) => {
            if (input.type === "checkbox" || input.type === "radio") {
              input.checked = false;
            } else if (input.type === "file") {
              input.value = "";
              const nameHolder = wrapper.querySelector(".file-name");
              if (nameHolder) nameHolder.textContent = "";
            } else {
              input.value = "";
            }
            input.classList.remove("is-invalid");
          });
        }
        updateSubmitState();
      };

      const addFileNameListener = (inputId, displayId) => {
        const input = document.getElementById(inputId);
        const display = document.getElementById(displayId);
        if (!input || !display) return;
        input.addEventListener("change", () => {
          const file = input.files && input.files[0];
          display.textContent = file ? `Arquivo selecionado: ${file.name}` : "";
        });
      };

      [
        ["laudoPcd", "laudoPcdName"],
        ["docResponsavel", "docResponsavelName"],
        ["docViolencia", "docViolenciaName"],
        ["docAcolhimento", "docAcolhimentoName"],
        ["docDependente", "docDependenteName"],
        ["docResidencia", "docResidenciaName"],
        ["docIdentidade", "docIdentidadeName"],
        ["cnhArquivo", "cnhArquivoName"],
      ].forEach(([inputId, displayId]) => addFileNameListener(inputId, displayId));

      const pcdSelect = document.getElementById("pcd");
      pcdSelect.addEventListener("change", () => {
        toggleFileSection(pcdSelect.value === "sim", "laudoPcdWrapper");
      });

      const maeAtipica = document.getElementById("maeAtipica");
      maeAtipica.addEventListener("change", () => {
        toggleFileSection(maeAtipica.value === "sim", "docResponsavelWrapper");
      });

      const vitimaViolencia = document.getElementById("vitimaViolencia");
      vitimaViolencia.addEventListener("change", () => {
        toggleFileSection(vitimaViolencia.value === "sim", "docViolenciaWrapper");
      });

      const acolhimento = document.getElementById("acolhimento");
      acolhimento.addEventListener("change", () => {
        toggleFileSection(acolhimento.checked, "docAcolhimentoWrapper");
      });

      const dependenteTratamento = document.getElementById("dependenteTratamento");
      dependenteTratamento.addEventListener("change", () => {
        toggleFileSection(dependenteTratamento.checked, "docDependenteWrapper");
      });

      const enderecoAtualizado = document.getElementById("enderecoAtualizado");
      enderecoAtualizado.addEventListener("change", () => {
        toggleFileSection(enderecoAtualizado.checked, "docResidenciaWrapper");
        const label = document.getElementById("docResidenciaLabel");
        if (!label) return;
        if (enderecoAtualizado.checked) {
          label.classList.add("required");
        } else {
          label.classList.remove("required");
        }
      });

      const categoriaSelect = document.getElementById("categoria");
      categoriaSelect.addEventListener("change", () => {
        const isAdicao = ["adicao_a", "adicao_b"].includes(categoriaSelect.value);
        toggleFileSection(isAdicao, "cnhNumeroWrapper");
        toggleFileSection(isAdicao, "cnhValidadeWrapper");
        toggleFileSection(isAdicao, "cnhArquivoWrapper");
      });

      const cpfInput = document.getElementById("cpf");
      const cpfValidator = (value) => {
        const digits = value.replace(/\D/g, "");
        if (digits.length !== 11 || /^([0-9])\1+$/.test(digits)) return false;
        let sum = 0;
        for (let i = 0; i < 9; i++) sum += parseInt(digits.charAt(i), 10) * (10 - i);
        let firstDigit = (sum * 10) % 11;
        if (firstDigit === 10) firstDigit = 0;
        if (firstDigit !== parseInt(digits.charAt(9), 10)) return false;
        sum = 0;
        for (let i = 0; i < 10; i++) sum += parseInt(digits.charAt(i), 10) * (11 - i);
        let secondDigit = (sum * 10) % 11;
        if (secondDigit === 10) secondDigit = 0;
        return secondDigit === parseInt(digits.charAt(10), 10);
      };

      const form = document.getElementById("cnhSocialForm");
      const submitButton = document.getElementById("submitButton");
      let submitReady = false;
      let validation;

      const isElementVisible = (element) => {
        if (!element) return false;
        let current = element;
        while (current && current !== document.body) {
          if (current.hasAttribute && current.hasAttribute("hidden")) {
            return false;
          }
          if (current.classList && current.classList.contains("d-none")) {
            return false;
          }
          current = current.parentElement;
        }
        return true;
      };

      const isFieldFilled = (element) => {
        if (!element) return true;
        if (!isElementVisible(element)) return true;
        if (element.disabled) return true;
        if (element.type === "checkbox" || element.type === "radio") {
          if (element.checked) return true;
          const group = element.name
            ? form.querySelectorAll(`[name="${CSS.escape(element.name)}"]`)
            : [];
          if (group.length) {
            return Array.from(group).some((input) => input.checked);
          }
          return false;
        }
        if (element.type === "file") {
          return element.files && element.files.length > 0;
        }
        const value = element.value != null ? String(element.value).trim() : "";
        return value.length > 0;
      };

      const setSubmitButtonState = (isReady) => {
        submitReady = isReady;
        submitButton.setAttribute("data-ready", isReady ? "true" : "false");
        submitButton.setAttribute("aria-disabled", isReady ? "false" : "true");
        submitButton.type = isReady ? "submit" : "button";
        submitButton.classList.toggle("disabled", !isReady);
      };

      setSubmitButtonState(false);
      const feedbackModalElement = document.getElementById("feedbackModal");
      const feedbackModalHeader = document.getElementById("feedbackModalHeader");
      const feedbackModalEmoji = document.getElementById("feedbackModalEmoji");
      const feedbackModalLabel = document.getElementById("feedbackModalLabel");
      const feedbackModalMessage = document.getElementById("feedbackModalMessage");
      const feedbackModalList = document.getElementById("feedbackModalList");
      const feedbackModalInstance = new bootstrap.Modal(feedbackModalElement);
      let pendingFocusElement = null;
      let pendingModalType = null;

      feedbackModalElement.addEventListener("shown.bs.modal", () => {
        if (pendingModalType === "alert") {
          const firstItem = feedbackModalList.querySelector("li span");
          if (firstItem) {
            firstItem.setAttribute("tabindex", "-1");
            firstItem.focus({ preventScroll: true });
            setTimeout(() => firstItem.removeAttribute("tabindex"), 0);
          }
        }
      });

      feedbackModalElement.addEventListener("hidden.bs.modal", () => {
        const focusTarget = pendingFocusElement;
        const modalType = pendingModalType;
        pendingFocusElement = null;
        pendingModalType = null;
        if (focusTarget && modalType === "alert") {
          setTimeout(() => focusTarget.focus({ preventScroll: true }), 100);
        }
      });

      const fieldLabels = {
        "#cpf": "CPF",
        "#genero": "Identifica√ß√£o de g√™nero",
        "#situacaoTrabalho": "Situa√ß√£o de trabalho atual",
        "#telefone": "Telefone/WhatsApp",
        "#email": "E-mail",
        "#emailConfirm": "Confirma√ß√£o de e-mail",
        "#preferenciaContato": "Canal de contato preferencial",
        "#cep": "CEP",
        "#logradouro": "Logradouro",
        "#numero": "N√∫mero do endere√ßo",
        "#bairro": "Bairro",
        "#cidade": "Munic√≠pio",
        "#rendaFamiliar": "Renda familiar mensal",
        "#pcd": "Pessoa com defici√™ncia (PCD)",
        "#maeAtipica": "Respons√°vel legal por pessoa PCD/TEA",
        "#vitimaViolencia": "V√≠nculo de viol√™ncia dom√©stica",
        "#racaCor": "Autodeclara√ß√£o de cor/ra√ßa",
        "#categoria": "Categoria desejada",
        "#turno": "Turno preferencial",
        "#polo": "Polo/CFC de prefer√™ncia",
        "#docIdentidade": "Documento de identifica√ß√£o oficial",
        "#lgpd": "Consentimento LGPD",
        "#veracidade": "Declara√ß√£o de veracidade",
        "#docResidencia": "Comprovante de resid√™ncia",
        "#laudoPcd": "Laudo m√©dico PCD",
        "#docResponsavel": "Comprovante de responsabilidade legal",
        "#docViolencia": "Documento de viol√™ncia dom√©stica",
        "#docAcolhimento": "Declara√ß√£o da unidade de acolhimento",
        "#docDependente": "Comprovante de tratamento terap√™utico cont√≠nuo",
        "#numeroCnh": "N√∫mero da CNH",
        "#validadeCnh": "Validade da CNH",
        "#cnhArquivo": "Arquivo da CNH",
      };

      const getFieldLabel = (selector) => {
        if (fieldLabels[selector]) {
          return fieldLabels[selector];
        }
        const element = form.querySelector(selector);
        if (element && element.id) {
          const associatedLabel = form.querySelector(`label[for="${element.id}"]`);
          if (associatedLabel) {
            return associatedLabel.textContent.trim();
          }
        }
        return element?.name || selector;
      };

      const showFeedbackModal = ({ type, message, items = [], focusElement = null }) => {
        const isSuccess = type === "success";
        feedbackModalHeader.classList.toggle("text-danger", !isSuccess);
        feedbackModalHeader.classList.toggle("text-success", isSuccess);
        feedbackModalEmoji.textContent = isSuccess ? "‚úÖ" : "‚ö†Ô∏è";
        feedbackModalLabel.textContent = isSuccess ? "Sucesso" : "Alerta";
        feedbackModalMessage.textContent = message;
        feedbackModalList.innerHTML = "";
        if (items.length) {
          feedbackModalList.classList.remove("d-none");
          items.forEach((item) => {
            const li = document.createElement("li");
            li.className = "d-flex align-items-start gap-2 mb-1";
            const icon = document.createElement("i");
            icon.className = isSuccess
              ? "bi bi-check-circle-fill text-success mt-1"
              : "bi bi-exclamation-triangle-fill text-danger mt-1";
            icon.setAttribute("aria-hidden", "true");
            const span = document.createElement("span");
            span.textContent = item;
            li.append(icon, span);
            feedbackModalList.appendChild(li);
          });
        } else {
          feedbackModalList.classList.add("d-none");
        }
        pendingFocusElement = focusElement;
        pendingModalType = type;
        feedbackModalInstance.show();
      };

      validation = new JustValidate(form, {
        errorFieldCssClass: "is-invalid",
        errorLabelCssClass: "text-danger mt-1",
        focusInvalidField: false,
        lockForm: true,
      });

      const collectInvalidFields = (additionalErrors = []) => {
        const invalidMap = new Map();
        Object.entries(validation.fields).forEach(([selector, field]) => {
          if (!field.isValid) {
            invalidMap.set(selector, {
              selector,
              element: field.elem,
              label: getFieldLabel(selector),
            });
          }
        });
        const requiredElements = Array.from(form.querySelectorAll("[data-required-field=\"true\"]"));
        requiredElements.forEach((element) => {
          const selector = element.id
            ? `#${element.id}`
            : element.name
            ? `[name='${CSS.escape(element.name)}']`
            : null;
          if (!selector || invalidMap.has(selector)) {
            return;
          }
          if (!isFieldFilled(element)) {
            invalidMap.set(selector, {
              selector,
              element,
              label: getFieldLabel(selector),
            });
          }
        });
        additionalErrors.forEach((error) => {
          if (!invalidMap.has(error.selector)) {
            invalidMap.set(error.selector, error);
          }
        });
        return Array.from(invalidMap.values());
      };

      const updateSubmitState = () => {
        if (!validation) {
          setSubmitButtonState(false);
          return;
        }
        const extraErrors = validateAdditionalRules(false);
        const invalidFields = collectInvalidFields(extraErrors);
        setSubmitButtonState(invalidFields.length === 0);
      };

      const applyPrefillValues = () => {
        if (!prefillValues || typeof prefillValues !== "object") {
          return;
        }
        const hasContent = Object.values(prefillValues).some((value) => {
          if (value == null) return false;
          if (typeof value === "string") return value.trim() !== "";
          return true;
        });
        if (!hasContent) {
          return;
        }

        const setTextValue = (id, value) => {
          if (value == null) return;
          if (typeof value === "string" && value.trim() === "") return;
          const element = document.getElementById(id);
          if (!element) return;
          const normalized = typeof value === "number" ? String(value) : value;
          element.value = normalized;
        };

        const setMaskedValue = (maskInstance, fallbackId, value) => {
          if (value == null) return;
          if (typeof value === "string" && value.trim() === "") return;
          const normalized = typeof value === "number" ? String(value) : value;
          if (maskInstance && typeof maskInstance.updateValue === "function") {
            maskInstance.value = normalized;
            maskInstance.updateValue();
          } else if (maskInstance) {
            maskInstance.value = normalized;
          } else if (fallbackId) {
            const element = document.getElementById(fallbackId);
            if (element) {
              element.value = normalized;
            }
          }
        };

        const setSelectValue = (id, value, triggerChange = false) => {
          if (value == null) return;
          if (typeof value === "string" && value.trim() === "") return;
          const element = document.getElementById(id);
          if (!element) return;
          const normalized = typeof value === "number" ? String(value) : value;
          element.value = normalized;
          if (triggerChange) {
            element.dispatchEvent(new Event("change"));
          }
        };

        const setCheckboxValue = (id, value) => {
          if (value == null) return;
          const element = document.getElementById(id);
          if (!element) return;
          const normalized = typeof value === "string" ? value.toLowerCase() : value;
          const shouldCheck = normalized === "sim" || normalized === "true" || normalized === true || normalized === 1 || normalized === "1";
          element.checked = shouldCheck;
          element.dispatchEvent(new Event("change"));
        };

        setTextValue("nomeCompleto", prefillValues.nomeCompleto);
        if (prefillValues.cpf && prefillValues.cpf.trim() !== "") {
          setMaskedValue(maskCpf, "cpf", prefillValues.cpf);
        }
        setTextValue("nis", prefillValues.nis);
        setTextValue("dataNascimento", prefillValues.dataNascimento);
        setSelectValue("genero", prefillValues.genero, true);
        setTextValue("nomeSocial", prefillValues.nomeSocial);
        if (prefillValues.cep && prefillValues.cep.trim() !== "") {
          setMaskedValue(maskCep, "cep", prefillValues.cep);
        }
        setTextValue("logradouro", prefillValues.logradouro);
        setTextValue("numero", prefillValues.numero);
        setTextValue("complemento", prefillValues.complemento);
        setTextValue("bairro", prefillValues.bairro);
        setTextValue("cidade", prefillValues.cidade);
        setSelectValue("uf", prefillValues.uf);
        setCheckboxValue("enderecoAtualizado", prefillValues.enderecoAtualizado);
        if (prefillValues.telefone && prefillValues.telefone.trim() !== "") {
          setMaskedValue(maskTelefone, "telefone", prefillValues.telefone);
        }
        setTextValue("email", prefillValues.email);
        setTextValue("emailConfirm", prefillValues.email);
        setSelectValue("preferenciaContato", prefillValues.preferenciaContato);
        setSelectValue("situacaoTrabalho", prefillValues.situacaoTrabalho);
        setCheckboxValue("mulherChefe", prefillValues.mulherChefe);
        setCheckboxValue("acolhimento", prefillValues.acolhimento);
        setCheckboxValue("dependenteTratamento", prefillValues.dependenteTratamento);
        setTextValue("rendaFamiliar", prefillValues.rendaFamiliar);
        setSelectValue("racaCor", prefillValues.racaCor);
        if (racaCorSelect) {
          racaCorSelect.dataset.lockedValue = racaCorSelect.value;
        }
        setCheckboxValue("pessoaPretaParda", prefillValues.pessoaPretaParda);
        setCheckboxValue("pessoaIndigena", prefillValues.pessoaIndigena);
        setCheckboxValue("pessoaTrans", prefillValues.pessoaTrans);
        setCheckboxValue("egressoSocioeducativo", prefillValues.egressoSocioeducativo);
        setCheckboxValue("pessoaQuilombola", prefillValues.pessoaQuilombola);
        setCheckboxValue("pessoaRua", prefillValues.pessoaRua);
        setSelectValue("pcd", prefillValues.pcd, true);
        setSelectValue("maeAtipica", prefillValues.maeAtipica, true);
        setSelectValue("vitimaViolencia", prefillValues.vitimaViolencia, true);
        setTextValue("necessidadesEspeciais", prefillValues.necessidadesEspeciais);

        if (validation) {
          if (typeof validation.refreshAll === "function") {
            validation.refreshAll();
          } else if (typeof validation.refresh === "function") {
            validation.refresh();
          }
        }
      };

      const updatePrefillFromSource = (values) => {
        if (!values || typeof values !== "object") {
          return;
        }
        const sanitized = sanitizePrefillObject(values);
        if (!hasPrefillContent(sanitized)) {
          return;
        }
        prefillValues = sanitized;
        applyPrefillValues();
        updateSubmitState();
      };

      window.setCnhSocialPrefill = (payload) => {
        let normalizedPayload = payload;
        if (typeof normalizedPayload === "string") {
          try {
            normalizedPayload = JSON.parse(normalizedPayload);
          } catch (error) {
            console.warn("N√£o foi poss√≠vel interpretar o payload de pr√©-preenchimento informado dinamicamente.", error);
            return;
          }
        }
        if (Array.isArray(normalizedPayload) && normalizedPayload.length) {
          const firstItem = normalizedPayload[0];
          if (firstItem && typeof firstItem === "object") {
            normalizedPayload =
              firstItem.data && typeof firstItem.data === "object" ? firstItem.data : firstItem;
          }
        }
        if (!normalizedPayload || typeof normalizedPayload !== "object") {
          return;
        }
        updatePrefillFromSource(normalizedPayload);
      };

      validation
        .addField("#genero", [{ rule: "required", errorMessage: "Informe a identifica√ß√£o de g√™nero" }])
        .addField("#situacaoTrabalho", [{ rule: "required", errorMessage: "Informe sua situa√ß√£o de trabalho" }])
        .addField("#telefone", [
          { rule: "required", errorMessage: "Informe um telefone v√°lido" },
          {
            validator: (value) => value.replace(/\D/g, "").length >= 10,
            errorMessage: "Informe DDD e n√∫mero",
          },
        ])
        .addField("#email", [{ rule: "required" }, { rule: "email", errorMessage: "E-mail inv√°lido" }])
        .addField("#emailConfirm", [
          { rule: "required", errorMessage: "Repita o e-mail informado" },
          {
            validator: (value) => value.trim() === (document.getElementById("email").value || "").trim(),
            errorMessage: "Os e-mails informados devem coincidir",
          },
        ])
        .addField("#preferenciaContato", [{ rule: "required" }])
        .addField("#cep", [
          {
            validator: () => {
              if (!enderecoEdicaoAtiva) return true;
              return maskCep.unmaskedValue.length === 8;
            },
            errorMessage: "Informe um CEP v√°lido",
          },
        ])
        .addField("#logradouro", [
          {
            validator: (value) => !enderecoEdicaoAtiva || value.trim().length > 0,
            errorMessage: "Informe o logradouro",
          },
        ])
        .addField("#numero", [
          {
            validator: () => {
              if (!numeroInput || numeroInput.readOnly) return true;
              const valor = numeroInput.value.trim();
              return /^(?:\d+|S\/N)$/.test(valor) && valor.length > 0;
            },
            errorMessage: "Informe o n√∫mero ou S/N",
          },
        ])
        .addField("#bairro", [
          {
            validator: (value) => !enderecoEdicaoAtiva || value.trim().length > 0,
            errorMessage: "Informe o bairro",
          },
        ])
        .addField("#cidade", [
          {
            validator: (value) => !enderecoEdicaoAtiva || value.trim().length > 0,
            errorMessage: "Informe o munic√≠pio",
          },
        ])
        .addField("#rendaFamiliar", [
          { rule: "required", errorMessage: "Informe a renda familiar" },
          {
            validator: (value) => value !== "" && !Number.isNaN(parseFloat(value)) && parseFloat(value) >= 0,
            errorMessage: "Valor inv√°lido",
          },
        ])
        .addField("#pcd", [{ rule: "required" }])
        .addField("#maeAtipica", [{ rule: "required" }])
        .addField("#vitimaViolencia", [{ rule: "required" }])
        .addField("#racaCor", [{ rule: "required", errorMessage: "Informe sua autodeclara√ß√£o" }])
        .addField("#categoria", [{ rule: "required" }])
        .addField("#turno", [{ rule: "required" }])
        .addField("#polo", [{ rule: "required" }])
        .addField("#docIdentidade", [
          { rule: "required", errorMessage: "Anexe um documento oficial" },
          {
            rule: "files",
            value: {
              files: {
                extensions: ["pdf", "jpg", "jpeg", "png"],
                maxSize: 5 * 1024 * 1024,
              },
            },
            errorMessage: "Formato ou tamanho inv√°lido (m√°x. 5 MB)",
          },
        ])
        .addField("#lgpd", [{ rule: "required", errorMessage: "Confirme o consentimento LGPD" }])
        .addField("#veracidade", [{ rule: "required", errorMessage: "Confirme a declara√ß√£o de veracidade" }]);

      const handleFormInteraction = async (event) => {
        const target = event.target;
        if (!target) return;
        const selector = target.id ? `#${target.id}` : null;
        if (selector && validation.fields[selector] && typeof validation.revalidateField === "function") {
          try {
            await validation.revalidateField(selector);
          } catch (error) {
            /* Ignora erros de revalida√ß√£o n√£o cr√≠ticos */
          }
        }
        if (
          selector === "#email" &&
          validation.fields["#emailConfirm"] &&
          typeof validation.revalidateField === "function"
        ) {
          try {
            await validation.revalidateField("#emailConfirm");
          } catch (error) {
            /* Ignora erros de revalida√ß√£o n√£o cr√≠ticos */
          }
        }
        updateSubmitState();
      };

      form.addEventListener("input", handleFormInteraction, true);
      form.addEventListener("change", handleFormInteraction, true);
      form.addEventListener("reset", () => {
        setSubmitButtonState(false);
        setTimeout(() => {
          applyPrefillValues();
          updateSubmitState();
        }, 0);
      });

      submitButton.addEventListener("click", async (event) => {
        if (submitReady) {
          return;
        }
        event.preventDefault();
        event.stopPropagation();
        let isValid = false;
        if (typeof validation.revalidate === "function") {
          isValid = await validation.revalidate();
        } else {
          isValid = await validation.validate();
        }
        const extraErrors = validateAdditionalRules(true);
        const invalidFields = collectInvalidFields(extraErrors);
        if (!isValid || invalidFields.length) {
          const focusField = invalidFields.find((field) => field.element && typeof field.element.focus === "function");
          showFeedbackModal({
            type: "alert",
            message: "Por favor, preencha os campos obrigat√≥rios listados antes de enviar.",
            items: invalidFields.map((field) => field.label),
            focusElement: focusField ? focusField.element : null,
          });
        }
        updateSubmitState();
      });

      function validateAdditionalRules(shouldShowErrors = true) {
        const extraErrors = [];
        const registerError = (selector, message, element) => {
          extraErrors.push({
            selector,
            element,
            label: getFieldLabel(selector),
          });
          if (shouldShowErrors && validation && typeof validation.showErrors === "function") {
            validation.showErrors({ [selector]: message });
          }
        };
        const cpfDigits = (cpfInput.value || "").replace(/\D/g, "");
        if (cpfDigits && cpfDigits.length === 11 && !cpfValidator(cpfInput.value || "")) {
          registerError("#cpf", "CPF inv√°lido", cpfInput);
        }
        if (cpfDigits && cpfDigits.length > 0 && cpfDigits.length !== 11) {
          registerError("#cpf", "CPF incompleto", cpfInput);
        }
        if (pcdSelect.value === "sim" && !document.getElementById("laudoPcd").files.length) {
          registerError("#laudoPcd", "Anexe o laudo PCD", document.getElementById("laudoPcd"));
        }
        if (maeAtipica.value === "sim" && !document.getElementById("docResponsavel").files.length) {
          registerError(
            "#docResponsavel",
            "Anexe os comprovantes",
            document.getElementById("docResponsavel")
          );
        }
        if (vitimaViolencia.value === "sim" && !document.getElementById("docViolencia").files.length) {
          registerError(
            "#docViolencia",
            "Anexe documento comprobat√≥rio ou declara√ß√£o",
            document.getElementById("docViolencia")
          );
        }
        if (acolhimento.checked && !document.getElementById("docAcolhimento").files.length) {
          registerError(
            "#docAcolhimento",
            "Anexe declara√ß√£o do servi√ßo de acolhimento",
            document.getElementById("docAcolhimento")
          );
        }
        if (dependenteTratamento.checked && !document.getElementById("docDependente").files.length) {
          registerError(
            "#docDependente",
            "Anexe comprovante do tratamento",
            document.getElementById("docDependente")
          );
        }
        if (enderecoAtualizado.checked && !document.getElementById("docResidencia").files.length) {
          registerError(
            "#docResidencia",
            "Comprovante obrigat√≥rio quando atualizar endere√ßo",
            document.getElementById("docResidencia")
          );
        }
        if (["adicao_a", "adicao_b"].includes(categoriaSelect.value)) {
          const numeroCnhField = document.getElementById("numeroCnh");
          if (!numeroCnhField.value.trim()) {
            registerError("#numeroCnh", "Informe o n√∫mero da CNH", numeroCnhField);
          }
          const validadeField = document.getElementById("validadeCnh");
          const validade = validadeField.value;
          if (!validade) {
            registerError("#validadeCnh", "Informe a validade da CNH", validadeField);
          } else {
            const diff = dayjs(validade).diff(dayjs(), "day");
            if (diff <= 30) {
              registerError(
                "#validadeCnh",
                "A CNH deve ter validade superior a 30 dias",
                validadeField
              );
            }
          }
          if (!document.getElementById("cnhArquivo").files.length) {
            registerError("#cnhArquivo", "Anexe a CNH", document.getElementById("cnhArquivo"));
          }
        }
        return extraErrors;
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        let isValid = false;
        if (typeof validation.revalidate === "function") {
          isValid = await validation.revalidate();
        } else {
          isValid = await validation.validate();
        }
        const extraErrors = validateAdditionalRules(true);
        const invalidFields = collectInvalidFields(extraErrors);
        if (!isValid || extraErrors.length) {
          setSubmitButtonState(false);
          const focusField = invalidFields.find((field) => field.element && typeof field.element.focus === "function");
          showFeedbackModal({
            type: "alert",
            message: "Por favor, verifique os campos obrigat√≥rios listados abaixo.",
            items: invalidFields.map((field) => field.label),
            focusElement: focusField ? focusField.element : null,
          });
          updateSubmitState();
          return;
        }

        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
          if (value instanceof File) {
            data[key] = value.name || null;
          } else if (Object.prototype.hasOwnProperty.call(data, key)) {
            if (Array.isArray(data[key])) {
              data[key].push(value);
            } else {
              data[key] = [data[key], value];
            }
          } else {
            data[key] = value;
          }
        });
        console.log("Inscri√ß√£o CNH Social", data);

        showFeedbackModal({
          type: "success",
          message: "Sua inscri√ß√£o foi enviada com sucesso. Voc√™ receber√° o protocolo por e-mail e WhatsApp.",
        });

        form.reset();
        applyPrefillValues();
        if (typeof validation.refreshAll === "function") {
          validation.refreshAll();
        } else if (typeof validation.refresh === "function") {
          validation.refresh();
        } else {
          Object.values(validation.fields).forEach((field) => {
            field.isValid = false;
            field.elem?.classList.remove("is-invalid");
          });
        }
        setSubmitButtonState(false);
        const docResidenciaLabel = document.getElementById("docResidenciaLabel");
        if (docResidenciaLabel) {
          docResidenciaLabel.classList.remove("required");
        }
        [
          "docResidenciaWrapper",
          "laudoPcdWrapper",
          "docResponsavelWrapper",
          "docViolenciaWrapper",
          "docAcolhimentoWrapper",
          "docDependenteWrapper",
          "cnhNumeroWrapper",
          "cnhValidadeWrapper",
          "cnhArquivoWrapper",
        ].forEach((id) => {
          toggleFileSection(false, id);
        });
        grupoMulherChefe.classList.add("d-none");
        editableFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.readOnly = true;
            field.setAttribute("aria-readonly", "true");
          }
        });
        ufSelect.disabled = true;
        enderecoEdicaoAtiva = false;
        btnAtualizarEndereco.setAttribute("aria-pressed", "false");
        if (cepStatus) {
          cepStatus.textContent = "";
        }
        document.querySelectorAll(".file-name").forEach((holder) => {
          holder.textContent = "";
        });
        setTimeout(() => updateSubmitState(), 0);
      });

      applyPrefillValues();
      updateSubmitState();
    </script>
  </body>
</html>
