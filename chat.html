<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tira-Dúvidas • CNH Social</title>

    <link
      rel="icon"
      href="https://cnhsocial.recife.pe.gov.br/wp-content/uploads/2025/12/CNH-Recife-Logo.png"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --brand-primary: #0053a4;
        --brand-highlight: #00a3ff;
        --text-strong: #1b263b;
        --text-muted: #5b6c8c;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        font-family: "Public Sans", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        color: var(--text-strong);
        min-height: 100vh;
      }

      .modal-dialog {
        max-width: 760px;
      }

      .modal-content {
        border: none;
        border-radius: 1.25rem;
        box-shadow: 0 24px 60px rgba(0, 35, 79, 0.2);
      }

      .modal-title {
        font-weight: 800;
        color: var(--text-strong);
      }

      .subtitle {
        color: var(--text-muted);
      }

    </style>
  </head>

  <body>
    <div
      class="modal fade"
      id="avaliacaoModal"
      tabindex="-1"
      aria-labelledby="avaliacaoModalLabel"
      aria-hidden="true"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-body p-4 p-md-5">
            <div class="d-flex flex-column gap-4">
              <div class="text-center">
                <img
                  src="https://cnhsocial.recife.pe.gov.br/wp-content/uploads/2025/12/CNH-Recife-Logo.png"
                  alt="CNH Recife"
                  class="img-fluid mb-3"
                  style="max-height: 72px"
                />
                <h1 class="modal-title h4 mb-1" id="avaliacaoModalLabel">
                  CNH Recife
                </h1>
                <p class="mb-0 subtitle fs-5">Envie sua dúvida</p>
              </div>

              <form
                id="formAvaliacao"
                class="d-flex flex-column gap-4"
                action="https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/avaliacao-cnh"
                method="POST"
              >
                <div class="row g-3">
                  <div class="col-12 col-md-6">
                    <label for="email" class="form-label fw-semibold">E-mail</label>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      name="email"
                      placeholder="seuemail@exemplo.com"
                      required
                    />
                    <div class="invalid-feedback">Informe um e-mail válido.</div>
                  </div>
                  <div class="col-12 col-md-6">
                    <label for="nome" class="form-label fw-semibold">Nome</label>
                    <input
                      type="text"
                      class="form-control"
                      id="nome"
                      name="nome"
                      placeholder="Digite seu nome"
                      required
                    />
                    <div class="invalid-feedback">Informe seu nome.</div>
                  </div>
                </div>

                <div>
                  <div class="d-flex align-items-center justify-content-between mb-1">
                    <label for="comentario" class="form-label fw-semibold mb-0"
                      >Descreva sua dúvida</label
                    >
                    <small class="text-danger">Obrigatório! Detalhe sua questão.</small>
                  </div>
                  <textarea
                    class="form-control"
                    id="comentario"
                    name="comentario"
                    rows="4"
                    placeholder="Escreva sua pergunta ou explique a situação."
                    aria-required="true"
                    required
                  ></textarea>
                  <div class="invalid-feedback">Deixe seu comentário.</div>
                </div>

                <div class="d-flex flex-column flex-sm-row gap-2 mt-2">
                  <button
                    type="submit"
                    id="submitButton"
                    class="btn btn-primary flex-fill"
                  >
                    Enviar dúvida
                  </button>
                  <button
                    type="button"
                    id="closeButton"
                    class="btn btn-outline-secondary flex-fill"
                  >
                    Fechar
                  </button>
                </div>
                <div
                  id="submitFeedback"
                  class="text-center small mt-2 text-muted"
                ></div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const modalElement = document.getElementById("avaliacaoModal");
        const modal = new bootstrap.Modal(modalElement, {
          backdrop: "static",
          keyboard: false,
        });
        modal.show();

        const form = document.getElementById("formAvaliacao");
        const submitFeedback = document.getElementById("submitFeedback");
        const submitButton = document.getElementById("submitButton");
        const redirectUrl = "https://cnhrecife.recife.pe.gov.br";
        const closeButton = document.getElementById("closeButton");
        const closeRedirectUrl = "https://cnh.recife.pe.gov.br";

        closeButton.addEventListener("click", () => {
          const targetWindow = window.top ?? window;
          targetWindow.location.href = closeRedirectUrl;
        });

        const iniciarRedirecionamento = (mensagemInicial) => {
          submitFeedback.classList.remove("text-muted", "text-danger");
          submitFeedback.classList.add("text-success");
          submitFeedback.textContent = `${mensagemInicial} Redirecionando...`;
          window.location.href = redirectUrl;
        };

        form.addEventListener("submit", async (event) => {
          event.preventDefault();
          if (!form.checkValidity()) {
            event.stopPropagation();
            form.classList.add("was-validated");
            return;
          }

          form.classList.add("was-validated");
          submitFeedback.textContent = "Enviando sua dúvida...";
          submitButton.disabled = true;

          try {
            const response = await fetch(form.action, {
              method: "POST",
              body: new FormData(form),
            });

            if (!response.ok) {
              throw new Error("Falha ao enviar a dúvida.");
            }

            iniciarRedirecionamento("Dúvida enviada com sucesso!");
          } catch (error) {
            submitFeedback.classList.remove("text-success", "text-muted");
            submitFeedback.classList.add("text-danger");
            submitFeedback.textContent =
              "Não foi possível enviar sua dúvida. Tente novamente em instantes.";
            submitButton.disabled = false;
          }
        });
      });
    </script>
  </body>
</html>
